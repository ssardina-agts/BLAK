<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- BLAK: BDI Learning Agent Kit -->
<project name="BLAK" basedir="." default="buildAll">

<!-- Root directory that contains the BLAK distribution -->
<property name="root.dir" value="."/>
<property name="blak.dep" value="${root.dir}/lib/blak.jar"/>
<property name="specs.dir" value="${root.dir}/specs"/>
<property name="results.dir" value="${root.dir}/results"/>

<!-- External dependencies. See README for installation instructions for JACK and WEKA -->
<property name="jack.dep" value="${root.dir}/lib/jack.jar"/>
<property name="weka.dep" value="${root.dir}/lib/weka.jar"/>

<!-- Check for external dependencies -->
<target name="dependencies" description="Check for external dependencies">
	<available file="${jack.dep}" property="jack.available"/>
	<fail message="JACK installation not found at ${jack.dep}. See README for installation instructions." unless="jack.available"/>
	<available file="${weka.dep}" property="weka.available"/>
	<fail message="WEKA installation not found at ${weka.dep}. See README for installation instructions." unless="weka.available"/>
</target>

<!-- Standard sub-tree structure for indvidual tests -->
<property name="build.dir" value="build"/>
<property name="build.classes.dir" value="${build.dir}"/>
<property name="build.classes.plans.dir" value="${build.classes.dir}/plans"/>
<property name="build.classes.events.dir" value="${build.classes.dir}/events"/>
<property name="build.classes.agents.dir" value="${build.classes.dir}/agents"/>
<property name="build.sources.dir" value="${build.dir}"/>
<property name="build.sources.plans.dir" value="${build.sources.dir}/plans"/>
<property name="build.sources.events.dir" value="${build.sources.dir}/events"/>
<property name="build.sources.agents.dir" value="${build.sources.dir}/agents"/>

<!-- Generic target to build a test sub-tree structure -->
<target name="makeTestTree" description="Generic target: generate build sub-tree structure for a specified experiment">
	<mkdir dir="${make.dir}/${build.classes.agents.dir}"/>
	<mkdir dir="${make.dir}/${build.classes.events.dir}"/>
	<mkdir dir="${make.dir}/${build.classes.plans.dir}"/>
	<mkdir dir="${make.dir}/${build.sources.agents.dir}"/>
	<mkdir dir="${make.dir}/${build.sources.events.dir}"/>
	<mkdir dir="${make.dir}/${build.sources.plans.dir}"/>
</target>

<!-- Generic target to generate JACK sources -->
<target name="generateJACK" description="Generic target: generate JACK sources for a specified experiment">
	<java fork="yes" classname="expGenerator.ExpGenerator" failonerror="true">
		<classpath>
			<pathelement location="${blak.dep}"/>
			<pathelement location="${jack.dep}"/>
			<pathelement location="${weka.dep}"/>
		</classpath>
		<arg line="-i ${specs.file}  -o ${make.dir}/${build.sources.dir}"/>
	</java>
</target>

<!-- Generic target to compile JACK sources -->
<target name="compileJACK" description="Generic target: compile JACK sources for a specified experiment">
	<java fork="yes" maxmemory="1g" classname="aos.main.JackBuild" failonerror="true">
		<arg line="-cp ${jack.dep}:${weka.dep}:${blak.dep} -wd ${make.dir}/${build.sources.dir} -r"/>
		<classpath>
			<pathelement location="${blak.dep}"/>
			<pathelement location="${jack.dep}"/>
			<pathelement location="${weka.dep}"/>
		</classpath>
	</java>
</target>

<!-- Generic target to build test JAR -->
<target name="makeJAR" description="Generic target: build a JAR archive for the experiment">
	<jar destfile="${make.dir}/${build.dir}/test01.jar" basedir="${make.dir}/${build.dir}" includes="agents/*.class trees/*.class events/*.class plans/*.class"/>
</target>

<!-- Generic target to build the entire test -->
<target name="buildTest" description="Generic target: build a specified experiment">
	<!-- Build the sub-tree hierarchy -->	
	<antcall target="makeTestTree">
		<param name="make.dir" value="${results.dir}/${test.name}"/>
	</antcall>
	<!-- Generate the JACK source files for the experiment -->	
	<antcall target="generateJACK">
		<param name="make.dir" value="${results.dir}/${test.name}"/>
		<param name="specs.file" value="${specs.file}"/>
	</antcall>
	<!-- Compile the JACK source files -->	
	<antcall target="compileJACK">
		<param name="make.dir" value="${results.dir}/${test.name}"/>
	</antcall>
	<!-- Build the test JAR -->
	<antcall target="makeJAR">
		<param name="make.dir" value="${results.dir}/${test.name}"/>
	</antcall>
</target>

<!-- Generic target to run a test within an experiment -->
<target name="runTest" description="Generic target: run an individual test within an experiment">
	<mkdir dir="${results.dir}/${test.name}/${subtest.name}"/>
	<tstamp prefix="start"/>
	<echo level="info" message="${start.DSTAMP}.${start.TSTAMP}: Started ${test.name}/${subtest.name}"/>
	<java fork="yes"  maxmemory="1g" classname="agents.Environment" failonerror="true" output="${results.dir}/${test.name}/${subtest.name}/stdout.log">
		<arg line="-d ${results.dir}/${test.name}/${subtest.name} ${run.params}"/>
		<classpath>
			<pathelement location="${jack.dep}"/>
			<pathelement location="${weka.dep}"/>
			<pathelement location="${blak.dep}"/>
			<pathelement location="${results.dir}/${test.name}/${build.dir}/${test.name}.jar"/>
		</classpath>
	</java>
</target>

<!-- Clean test -->
<target name="cleanTest" description="Delete all build files for a specified experiment">
	<delete dir="${results.dir}/${test.name}/${build.dir}"/>
</target>

<!-- Clean -->
<target name="clean" description="Delete all build files">
	<delete includeemptydirs="true">
		<fileset dir="${results.dir}" includes="**/build/**"/>
	</delete>
</target>

<!-- Clean -->
<target name="cleanAll" description="Delete all generated files including results">
	<delete dir="${results.dir}"/>
</target>

<!-- Default targets -->
<target name="buildAll" description="Build all tests" depends="dependencies,buildTest01"/>
<target name="runAll" description="Run all tests" depends="runTest01"/>



<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<!-- BEGIN TESTS (Add new tests targets here) ~~~~~~~~~~~~~~~~~~~~-->
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->


<!-- TEST 01 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<target name="buildTest01" description="Build Test 01">
	<antcall target="cleanTest">
		<param name="test.name" value="test01"/>
	</antcall>
	<antcall target="buildTest">
		<param name="test.name" value="test01"/>
		<param name="specs.file" value="${specs.dir}/concurrentFail.txt"/>
	</antcall>
</target>
<target name="runTest01" description="Run Test 01">
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="01"/>
		<param name="run.params" value="-o stable-s-4-1.csv -i 4000 -u stable -s probabilistic -m 1 -e 0.3"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="02"/>
		<param name="run.params" value="-o stable-s-4-2.csv -i 4000 -u stable -s probabilistic -m 1 -e 0.3"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="03"/>
		<param name="run.params" value="-o stable-s-4-3.csv -i 4000 -u stable -s probabilistic -m 1 -e 0.3"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="04"/>
		<param name="run.params" value="-o stable-s-4-4.csv -i 4000 -u stable -s probabilistic -m 1 -e 0.3"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="05"/>
		<param name="run.params" value="-o stable-s-4-5.csv -i 4000 -u stable -s probabilistic -m 1 -e 0.3"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="06"/>
		<param name="run.params" value="-o concurrent-cc-4-1.csv -i 4000 -u concurrent -s probabilistic -m 1"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="07"/>
		<param name="run.params" value="-o concurrent-cc-4-2.csv -i 4000 -u concurrent -s probabilistic -m 1"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="08"/>
		<param name="run.params" value="-o concurrent-cc-4-3.csv -i 4000 -u concurrent -s probabilistic -m 1"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="09"/>
		<param name="run.params" value="-o concurrent-cc-4-4.csv -i 4000 -u concurrent -s probabilistic -m 1"/>
	</antcall>
	<antcall target="runTest">
		<param name="test.name" value="test01"/>
		<param name="subtest.name" value="10"/>
		<param name="run.params" value="-o concurrent-cc-4-5.csv -i 4000 -u concurrent -s probabilistic -m 1"/>
	</antcall>
</target>


<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<!-- END TESTS TARGETS ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
<!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->

</project>
